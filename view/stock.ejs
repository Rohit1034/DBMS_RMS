<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock List</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <br>
        <h2>Stock List</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Stock ID</th>
                    <th>Stock Name</th>
                    <th>FPS ID</th>
                    <th>Quantity</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="stockTableBody">
                <% if (stock && stock.length > 0) { %>
                    <% stock.forEach(stock => { %>
                        <tr>
                            <td><%= stock.stock_id %></td>
                            <td><%= stock.stock_name %></td>
                            <td><%= fps_id %></td> <!-- Use fps_id here -->
                            <td><%= stock.quantity %></td>
                            <td><%= stock.stock_date %></td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="5">No stock data available</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('stockForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const stockId = document.getElementById('stock_id').value;
            const stockName = document.getElementById('stock_name').value;
            const fpsId = document.getElementById('fps_id').value;
            const quantity = document.getElementById('quantity').value;
            const stockDate = document.getElementById('stock_date').value;

            const response = await fetch('/add_stock', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ stock_id: stockId, stock_name: stockName, fps_id: fpsId, quantity: quantity, stock_date: stockDate }),
            });

            const result = await response.json();
            if (result.success) {
                const newRow = document.createElement('tr');

                const stockIdCell = document.createElement('td');
                stockIdCell.textContent = stockId;
                newRow.appendChild(stockIdCell);

                const stockNameCell = document.createElement('td');
                stockNameCell.textContent = stockName;
                newRow.appendChild(stockNameCell);

                const fpsIdCell = document.createElement('td');
                fpsIdCell.textContent = fpsId;
                newRow.appendChild(fpsIdCell);

                const quantityCell = document.createElement('td');
                quantityCell.textContent = quantity;
                newRow.appendChild(quantityCell);

                const stockDateCell = document.createElement('td');
                stockDateCell.textContent = stockDate;
                newRow.appendChild(stockDateCell);

                const tableBody = document.getElementById('stockTableBody');
                if (tableBody.children[0].textContent === 'No stock data available') {
                    tableBody.innerHTML = '';  // Clear the "No stock data available" row
                }
                tableBody.appendChild(newRow);

                document.getElementById('stockForm').reset();
            } else {
                alert('Failed to add stock. Please try again.');
            }
        });
    </script>
</body>
</html>
